# トラブルシューティング

## 起動時のエラー

### 「モデルファイルが見つかりません」

**原因**: RVMモデル（TorchScript形式）が `models/` フォルダにない

**解決方法**:
1. 以下のURLからモデルをダウンロード
   https://github.com/PeterL1n/RobustVideoMatting/releases/download/v1.0.0/rvm_mobilenetv3_fp32.torchscript
2. `models/rvm_mobilenetv3.torchscript` として配置

**注意**: リポジトリにはモデルファイルが同梱されているため、通常は自動的に利用可能です。

---

### 「ffmpegが見つかりません」

**原因**: ffmpegがインストールされていない、またはPATHに通っていない

**解決方法**:

#### Windows
1. https://ffmpeg.org/download.html からダウンロード
2. `ffmpeg.exe` を `ffmpeg/` フォルダに配置

または、システムPATHに追加

#### macOS
```bash
brew install ffmpeg
```

---

### 「GPUが検出されませんでした」（警告）

**原因**: NVIDIA GPUがない、またはCUDAドライバーがインストールされていない

**解決方法**:
- GPU版を使用する場合は、NVIDIAドライバーをインストール
- CPUでも処理可能（ただし非常に低速）

---

## 処理中のエラー

### 「動画を開けません」

**原因**: 対応していない動画形式、または破損したファイル

**解決方法**:
1. 対応形式（.mp4, .mov, .m4v）であることを確認
2. 別の動画プレーヤーで再生できるか確認
3. 必要に応じて、HandBrake等でMP4に変換

---

### 「ffmpegエラー」

**原因**: ffmpegの出力処理で問題が発生

**考えられる原因と対策**:

| 原因 | 対策 |
|-----|------|
| ディスク容量不足 | 十分な空き容量を確保（動画サイズの3〜5倍推奨） |
| 出力先に書き込み権限がない | 別のフォルダを指定 |
| ファイル名に特殊文字 | 日本語やスペースを含まないパスを使用 |

---

### 処理が途中で止まる

**原因**: メモリ不足、またはGPUメモリ不足

**解決方法**:
1. 他のアプリケーションを終了
2. 動画を短く分割して処理
3. 解像度を下げて試す

---

## 出力ファイルの問題

### 出力動画が真っ黒

**原因**: アルファチャンネルが正しく処理されていない

**確認方法**:
- Adobe Premiere等で読み込み、透過として扱われているか確認
- 背景に別の画像/動画を配置して確認

---

### 出力動画を再生できない

**原因**: 使用しているプレーヤーがWebM (VP9)に対応していない

**解決方法**:
- VLC Media Playerで再生を試す
- Webブラウザ（Chrome, Firefox, Edge）で開く
- 動画編集ソフト（Premiere, DaVinci等）で読み込む
- Canvaにアップロードして確認

---

### WebM変換が失敗する

**原因**: WebM (VP9)への変換中にエラーが発生

**考えられる原因と対策**:

| 原因 | 対策 |
|-----|------|
| ffmpegがVP9に対応していない | 最新版のffmpegをインストール |
| ディスク容量不足 | 十分な空き容量を確保 |
| 一時ファイルの破損 | 再度処理を実行 |

**注意**: 変換に失敗した場合、中間ファイル（MOV形式）が残ることがあります。

---

### CanvaでWebMが読み込めない

**原因**: ファイルサイズが大きすぎる、または形式が正しくない

**解決方法**:
1. ファイルサイズを確認（Canvaには制限があります）
2. 動画の長さを短くして再処理
3. Webブラウザで開いて透過が正しく表示されるか確認

---

### 切り抜きの精度が悪い

**考えられる原因と対策**:

| 状況 | 対策 |
|-----|------|
| 人物と背景の色が似ている | 背景との色の差がある環境で撮影 |
| 動きが激しい | なるべく静止した状態で撮影 |
| 髪の毛などの細部 | RVMの限界、完全な精度は難しい |
| フレーム間でチラつく | RVMは比較的チラつきが少ないが、完全ではない |

---

## パフォーマンスの問題

### 処理が非常に遅い

**確認事項**:
1. デバイス情報を確認（アプリ起動時に表示）
   - 「CPU」と表示されている場合は非常に遅い
   - 「NVIDIA GPU」または「Apple Silicon」なら正常

2. GPUが認識されていない場合:
   - NVIDIAドライバーを最新版に更新
   - CUDA Toolkitのインストールを確認

### GPU使用率が低い

**原因**: バッチサイズが小さい、またはI/Oがボトルネック

**現在の実装**: フレームごとに逐次処理のため、最大効率ではない

---

## ビルド時のエラー

### PyInstallerでエラー

**よくある原因**:
1. 仮想環境がアクティブになっていない
2. 依存パッケージが不足
3. モデルファイルやffmpegが配置されていない

**解決方法**:
```batch
# 仮想環境をアクティブ化してから実行
venv_gpu\Scripts\activate
build_gpu.bat
```

---

## それでも解決しない場合

1. エラーメッセージ全文を記録
2. 環境情報を収集:
   - OS: Windows 10/11, macOS
   - Python: `python --version`
   - PyTorch: `python -c "import torch; print(torch.__version__)"`
   - GPU: `nvidia-smi`（Windows + NVIDIA）
3. 開発担当者に報告
