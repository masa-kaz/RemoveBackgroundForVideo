# 動画背景除去ツール - UI仕様書

## 概要
動画から背景を除去するデスクトップアプリケーションのUI仕様

### デザイン原則
- **シンプル** - 1画面で完結、余計な要素を排除
- **視覚的フィードバック** - 状態が一目でわかる
- **直感的** - 説明不要で使える
- **アクセシビリティ** - 細かい文字が苦手な人にも使いやすい

### 技術スタック
- CustomTkinter（モダンなTkinterラッパー）
- tkinterdnd2（ドラッグ＆ドロップ対応）
- ライトモード固定

---

## カラーテーマ（META AI LABO準拠）

ロゴの色を基調としたカラーテーマ

| 用途 | カラーコード | 説明 |
|------|-------------|------|
| **Primary** | #8BC34A | 葉っぱの黄緑（ブランドカラー） |
| **Primary Dark** | #689F38 | 葉っぱの濃い緑 |
| **Primary Hover** | #7CB342 | ホバー時 |
| **Secondary** | #263238 | フィルム枠のダークネイビー |
| **Success** | #4CAF50 | 成功 |
| **Warning** | #FF9800 | 警告 |
| **Danger** | #F44336 | エラー |
| **Background** | #FAFAFA | 明るい背景 |
| **Card** | #FFFFFF | カード背景 |
| **Border** | #E0E0E0 | ボーダー |
| **Text** | #263238 | メインテキスト |
| **Text Secondary** | #616161 | サブテキスト（コントラスト確保） |

---

## フォントサイズ（アクセシビリティ対応・大きめ）

| 要素 | サイズ |
|------|--------|
| タイトル | 28px Bold |
| サブタイトル | 16px |
| ボタンテキスト | 20px |
| ファイル名 | 18px |
| 動画情報 | 16px |
| 補助テキスト | 15px |
| 円形プログレス% | 32px Bold |
| フレーム数 | 16px |
| フッター（デバイス情報） | 14px |

---

## 画面状態

### 状態1: 初期画面

```
┌─────────────────────────────────────────┐
│                                         │
│  [ロゴ]  動画背景除去ツール              │  ← 28px, ロゴ左配置
│          by META AI LABO               │  ← 16px
│                                         │
│  ┌───────────────────────────────────┐  │
│  │                                   │  │
│  │              📁                   │  │
│  │                                   │  │
│  │    動画をドラッグ＆ドロップ        │  │  ← 18px
│  │       または クリック             │  │
│  │                                   │  │
│  │       .mp4 .mov .m4v              │  │  ← 15px
│  └───────────────────────────────────┘  │
│                                         │
│  ⚡ Apple M1 - 高速処理                 │  ← 14px
└─────────────────────────────────────────┘
```

#### 要素
- ヘッダー: ロゴ（左）+ アプリ名（横並び）+ サブタイトル
- ドロップゾーン: ファイル選択エリア（クリック・D&D対応）
- フッター: デバイス情報（GPU/CPU）

#### 操作
- ドロップゾーンをクリック → ファイル選択ダイアログ
- ドラッグ＆ドロップ → ファイル選択
- 対応形式: .mp4, .mov, .m4v

---

### 状態2: ファイル選択後

```
┌─────────────────────────────────────────┐
│                                         │
│  [ロゴ]  動画背景除去ツール              │
│          by META AI LABO               │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │                                   │  │
│  │       [サムネイル画像]             │  │
│  │         400×225px                │  │
│  │                                   │  │
│  │        sample_video.mp4          │  │  ← 18px
│  │          7分23秒の動画           │  │  ← 16px
│  └───────────────────────────────────┘  │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │       🚀 背景を除去する           │  │  ← 20px, 高さ60px
│  └───────────────────────────────────┘  │
│                                         │
│          別の動画を選択                 │  ← 16px, リンク
│                                         │
│  ⚡ Apple M1 - 高速処理                 │
└─────────────────────────────────────────┘
```

#### 要素
- サムネイル: 動画の最初のフレーム（最大400×225px）
- ファイル名: 選択した動画のファイル名
- 動画情報: 再生時間のみ（シンプル化）
- CTAボタン: 「🚀 背景を除去する」
- リンク: 「別の動画を選択」

#### 操作
- 「背景を除去する」ボタン → 状態3（処理中）へ
- 「別の動画を選択」 → ファイル選択ダイアログ
- ドラッグ＆ドロップ → 動画を差し替え（トースト通知）

---

### 状態3: 処理中

```
┌─────────────────────────────────────────┐
│                                         │
│  [ロゴ]  動画背景除去ツール              │
│          by META AI LABO               │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │  │
│  │ ░░░ [サムネイル+半透明] ░░░░░░░░ │  │
│  │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │  │
│  │         ┌─────────┐              │  │
│  │         │   67%   │              │  │  ← 32px
│  │         └─────────┘              │  │
│  │       8,902 / 13,290 f           │  │  ← 16px
│  └───────────────────────────────────┘  │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │          キャンセル               │  │  ← 20px, 高さ60px
│  └───────────────────────────────────┘  │
│                                         │
│  ⚡ Apple M1 - 高速処理                 │
└─────────────────────────────────────────┘
```

#### 要素
- サムネイル: 半透明（オーバーレイ効果）
- 円形プログレス: サムネイル上にオーバーレイ表示（140×140px）
  - 中央にパーセンテージ（32px）
  - 下部にフレーム数（16px）
- キャンセルボタン: 赤枠

#### 操作
- 「キャンセル」ボタン → 確認ダイアログ → 状態2に戻る

---

### 状態4: 処理完了

```
┌─────────────────────────────────────────┐
│                                         │
│  [ロゴ]  動画背景除去ツール              │
│          by META AI LABO               │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │                                   │  │
│  │   [背景除去済みサムネイル]         │  │
│  │    (透明部分=市松模様)            │  │
│  │                                   │  │
│  │          ✅ 完了!                 │  │  ← 20px
│  │                                   │  │
│  └───────────────────────────────────┘  │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │       💾 ファイルを保存           │  │  ← 20px, 高さ60px
│  └───────────────────────────────────┘  │
│                                         │
│     やり直す  |  別の動画を処理         │  ← 16px, リンク
│                                         │
│  ⚡ Apple M1 - 高速処理                 │
└─────────────────────────────────────────┘
```

#### 要素
- サムネイル: 背景除去済みの最初のフレーム
  - 透明部分は市松模様で表現
- 完了メッセージ: ✅ 完了!
- CTAボタン: 「💾 ファイルを保存」
- リンク: 「やり直す」「別の動画を処理」

#### 操作
- 「ファイルを保存」ボタン → 保存先選択ダイアログ → 保存完了ダイアログ
- 「やり直す」 → 同じ動画で状態2に戻る
- 「別の動画を処理」 → 状態1に戻る

---

## 動画差し替え時の挙動

### 状態2で別の動画を選択した場合
1. 即座に新しい動画に切り替え
2. サムネイルがフェードインで切り替わる
3. トースト通知: 「📁 動画を変更しました」（2秒後に自動消去）

---

## レスポンシブ仕様

### 基本方針
**「コンテンツ中央配置 + 横幅追従 + 縦はスクロール」**

### ウィンドウサイズ

| 項目 | 値 |
|------|-----|
| 初期サイズ | 600×750 |
| 最小サイズ | 520×650 |
| 最大サイズ | 制限なし |

### 横方向の挙動

| ウィンドウ幅 | 挙動 |
|-------------|------|
| **520px未満** | リサイズ不可（最小制限） |
| **520〜800px** | コンテンツが横幅に追従して伸びる |
| **800px以上** | コンテンツ最大幅800pxで中央配置、左右に余白 |

### 縦方向の挙動

| ウィンドウ高さ | 挙動 |
|---------------|------|
| **650px未満** | リサイズ不可（最小制限） |
| **650px以上** | 下部に余白が増える |

### 各要素のサイズ挙動

| 要素 | 挙動 |
|------|------|
| ヘッダー（ロゴ+タイトル） | 固定サイズ、左寄せ |
| サムネイル領域 | 横幅に追従（max 500px）、アスペクト比16:9維持 |
| ボタン | 横幅に追従（max 500px）、高さ固定60px |
| 円形プログレス | 固定サイズ 140×140px、サムネイル中央に配置 |
| フォント | 固定サイズ（変更しない） |
| 余白（パディング） | 固定 24px |

### サムネイルのレスポンシブ

| ウィンドウ幅 | サムネイル幅 | サムネイル高さ |
|-------------|-------------|---------------|
| 520px | 472px | 265px |
| 700px | 500px（最大） | 281px |
| 1000px | 500px（中央配置） | 281px |

### まとめ表

| 項目 | 最小 | 最大 | 挙動 |
|------|------|------|------|
| ウィンドウ幅 | 520px | 制限なし | - |
| ウィンドウ高さ | 650px | 制限なし | - |
| コンテンツ幅 | 472px | 800px | 追従 |
| サムネイル幅 | 472px | 500px | 追従 |
| ボタン幅 | 472px | 500px | 追従 |
| 円形プログレス | 140px | 140px | 固定 |
| フォント | 固定 | 固定 | 変更なし |

---

## ダイアログ仕様

### ダイアログ共通仕様

| 項目 | 値 |
|------|-----|
| 背景色 | #FFFFFF |
| 角丸 | 12px |
| 親ウィンドウの中央に配置 | ✅ |
| モーダル（背景操作不可） | ✅ |
| パディング | 24px |
| アイコンサイズ | 36px |
| タイトルフォント | 20px Bold |
| 本文フォント | 16px |
| ボタン高さ | 50px |
| ボタンフォント | 18px |

---

### 1. 保存先選択ダイアログ

**OS標準のファイル保存ダイアログを使用**

| 項目 | 値 |
|------|-----|
| タイトル | 「保存先を選択」 |
| デフォルトファイル名 | `{元のファイル名}_nobg.mov` |
| ファイルタイプ | MOV (ProRes 4444) |

---

### 2. 保存完了ダイアログ

```
┌─────────────────────────────────────┐
│                                     │
│              💾                     │  ← 36px
│                                     │
│     ファイルを保存しました           │  ← 20px Bold
│                                     │
│       output_nobg.mov               │  ← 16px, Secondary
│                                     │
│  ┌─────────────┐  ┌─────────────┐  │
│  │ フォルダを開く │  │   閉じる    │  │  ← 18px, 高さ50px
│  └─────────────┘  └─────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

| 項目 | 値 |
|------|-----|
| サイズ | 420×220 |
| 「フォルダを開く」ボタン | Primary色 |
| 「閉じる」ボタン | Secondary（枠線のみ） |

---

### 3. GPU警告ダイアログ

```
┌─────────────────────────────────────┐
│                                     │
│              ⚠️                     │  ← 36px
│                                     │
│       GPUが検出されませんでした      │  ← 20px Bold
│                                     │
│    処理は可能ですが、非常に時間が     │  ← 16px
│    かかります（数時間〜）            │
│                                     │
│  ┌─────────────────────────────┐   │
│  │         了解                 │   │  ← 18px, 高さ50px
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

| 項目 | 値 |
|------|-----|
| サイズ | 420×240 |
| 表示タイミング | アプリ起動時（GPUなしの場合） |

---

### 4. エラーダイアログ

```
┌─────────────────────────────────────┐
│                                     │
│              ❌                     │  ← 36px
│                                     │
│       エラーが発生しました           │  ← 20px Bold
│                                     │
│    {エラーメッセージ}                │  ← 16px
│                                     │
│  ┌─────────────────────────────┐   │
│  │         閉じる               │   │  ← 18px, 高さ50px
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

| 項目 | 値 |
|------|-----|
| サイズ | 420×220（メッセージ長で可変） |

---

### 5. キャンセル確認ダイアログ

```
┌─────────────────────────────────────┐
│                                     │
│              ⚠️                     │  ← 36px
│                                     │
│     処理をキャンセルしますか？       │  ← 20px Bold
│                                     │
│     進行中の処理は破棄されます       │  ← 16px
│                                     │
│  ┌─────────────┐  ┌─────────────┐  │
│  │   続ける    │  │ キャンセル   │  │  ← 18px, 高さ50px
│  └─────────────┘  └─────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

| 項目 | 値 |
|------|-----|
| サイズ | 420×220 |
| 「続ける」ボタン | Primary色 |
| 「キャンセル」ボタン | Danger色（赤枠） |

---

### 6. 保存キャンセル確認ダイアログ

```
┌─────────────────────────────────────┐
│                                     │
│              ⚠️                     │  ← 36px
│                                     │
│     保存せずに終了しますか？         │  ← 20px Bold
│                                     │
│     処理結果は破棄されます           │  ← 16px
│                                     │
│  ┌─────────────┐  ┌─────────────┐  │
│  │  保存する   │  │   破棄     │   │  ← 18px, 高さ50px
│  └─────────────┘  └─────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

| 項目 | 値 |
|------|-----|
| サイズ | 420×220 |
| 「保存する」ボタン | Primary色 |
| 「破棄」ボタン | Danger色（赤枠） |

---

### 7. トースト通知

```
┌─────────────────────────────────┐
│  📁 動画を変更しました          │  ← 16px
└─────────────────────────────────┘
```

| 項目 | 値 |
|------|-----|
| 表示位置 | 画面下部中央 |
| 背景色 | #263238 (ダーク) |
| テキスト色 | #FFFFFF |
| 表示時間 | 2秒後に自動消去 |
| アニメーション | フェードイン/アウト |

---

## アクセシビリティ対応

### 対応内容

| 項目 | 対応 |
|------|------|
| フォントサイズ | 通常より大きめ（上記参照） |
| コントラスト比 | WCAG AA基準以上 |
| ボタン・タップ領域 | 最低44×44px以上 |
| アイコン + テキスト | 併用（アイコンだけにしない） |
| 情報量の削減 | 専門的な情報は省略（fps、解像度など） |
| 状態の明示 | 色だけでなくテキスト・形でも伝える |

---

## 実装状況

### 画面状態
- [x] 状態1: 初期画面（基本）
- [x] 状態1: ロゴ左配置
- [x] 状態2: ファイル選択後
- [x] 状態2: サムネイル表示
- [x] 状態2: 動画情報表示（簡略化）
- [x] 状態3: 円形プログレス（サムネイル上オーバーレイ）
- [x] 状態4: 背景除去済みサムネイル
- [x] 状態4: グリーンバック背景（市松模様から変更）

### 動画差し替え
- [x] トースト通知
- [ ] フェードアニメーション

### ダイアログ
- [x] 保存完了ダイアログ
- [x] GPU警告ダイアログ
- [x] エラーダイアログ
- [x] キャンセル確認ダイアログ
- [ ] 保存キャンセル確認ダイアログ

### レスポンシブ
- [x] 最小サイズ制限
- [x] 最大幅800pxで中央配置
- [x] サムネイルのアスペクト比維持

### カラーテーマ
- [x] META AI LABOカラーに変更

---

## GUIテスト仕様

GUIが仕様通りに実装されているかを確認するテストコード

### テストファイル
`tests/test_gui.py`

### テスト項目

#### 1. カラーテーマテスト
```python
class TestColorTheme:
    """カラーテーマが仕様通りか確認"""

    def test_primary_color(self):
        """Primary色が#8BC34Aであること"""

    def test_secondary_color(self):
        """Secondary色が#263238であること"""

    def test_background_color(self):
        """背景色が#FAFAFAであること"""

    def test_text_color(self):
        """テキスト色が#263238であること"""

    def test_danger_color(self):
        """Danger色が#F44336であること"""
```

#### 2. フォントサイズテスト
```python
class TestFontSize:
    """フォントサイズが仕様通りか確認"""

    def test_title_font_size(self):
        """タイトルが28pxであること"""

    def test_subtitle_font_size(self):
        """サブタイトルが16pxであること"""

    def test_button_font_size(self):
        """ボタンテキストが20pxであること"""

    def test_filename_font_size(self):
        """ファイル名が18pxであること"""

    def test_progress_percent_font_size(self):
        """円形プログレス%が32pxであること"""
```

#### 3. ウィンドウサイズテスト
```python
class TestWindowSize:
    """ウィンドウサイズが仕様通りか確認"""

    def test_initial_size(self):
        """初期サイズが600x750であること"""

    def test_minimum_size(self):
        """最小サイズが520x650であること"""

    def test_resizable(self):
        """リサイズ可能であること"""
```

#### 4. レスポンシブテスト
```python
class TestResponsive:
    """レスポンシブ挙動が仕様通りか確認"""

    def test_content_max_width(self):
        """コンテンツ最大幅が800pxであること"""

    def test_thumbnail_max_width(self):
        """サムネイル最大幅が500pxであること"""

    def test_button_max_width(self):
        """ボタン最大幅が500pxであること"""

    def test_circular_progress_fixed_size(self):
        """円形プログレスが140x140px固定であること"""
```

#### 5. UI要素テスト
```python
class TestUIElements:
    """UI要素が仕様通りか確認"""

    def test_logo_position_left(self):
        """ロゴがタイトルの左に配置されていること"""

    def test_drop_zone_exists(self):
        """ドロップゾーンが存在すること"""

    def test_footer_device_info(self):
        """フッターにデバイス情報が表示されること"""

    def test_button_height(self):
        """ボタン高さが60pxであること"""
```

#### 6. 画面状態遷移テスト
```python
class TestScreenStates:
    """画面状態遷移が仕様通りか確認"""

    def test_initial_state(self):
        """初期状態でドロップゾーンが表示されること"""

    def test_file_selected_state(self):
        """ファイル選択後にサムネイルとボタンが表示されること"""

    def test_processing_state(self):
        """処理中に円形プログレスとキャンセルボタンが表示されること"""

    def test_complete_state(self):
        """完了後に背景除去済みサムネイルと保存ボタンが表示されること"""
```

#### 7. ダイアログテスト
```python
class TestDialogs:
    """ダイアログが仕様通りか確認"""

    def test_save_complete_dialog_size(self):
        """保存完了ダイアログが420x220であること"""

    def test_gpu_warning_dialog_size(self):
        """GPU警告ダイアログが420x240であること"""

    def test_dialog_centered(self):
        """ダイアログが親ウィンドウの中央に配置されること"""

    def test_dialog_modal(self):
        """ダイアログがモーダルであること"""

    def test_dialog_button_height(self):
        """ダイアログのボタン高さが50pxであること"""
```

#### 8. アクセシビリティテスト
```python
class TestAccessibility:
    """アクセシビリティが仕様通りか確認"""

    def test_minimum_tap_target_size(self):
        """タップ領域が最低44x44px以上であること"""

    def test_icon_with_text(self):
        """アイコンにテキストが併記されていること"""

    def test_contrast_ratio(self):
        """コントラスト比がWCAG AA基準以上であること"""
```

#### 9. トースト通知テスト
```python
class TestToast:
    """トースト通知が仕様通りか確認"""

    def test_toast_position(self):
        """トーストが画面下部中央に表示されること"""

    def test_toast_auto_dismiss(self):
        """トーストが2秒後に自動消去されること"""

    def test_toast_background_color(self):
        """トースト背景色が#263238であること"""
```

### テスト実行方法
```bash
# GUIテストのみ実行
pytest tests/test_gui.py -v

# ヘッドレスモードで実行（CI用）
pytest tests/test_gui.py -v --headless
```

### 注意事項
- GUIテストはTkinterのイベントループを使用するため、特別な設定が必要
- CI環境ではヘッドレスモード（Xvfb等）が必要
- 一部のテスト（アニメーション等）は目視確認が必要な場合あり
